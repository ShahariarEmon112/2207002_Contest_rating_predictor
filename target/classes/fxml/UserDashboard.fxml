<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<BorderPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="com.contestpredictor.controller.UserDashboardController"
            stylesheets="@../css/styles.css">
    
    <!-- Top Header -->
    <top>
        <HBox alignment="CENTER_LEFT" spacing="20" style="-fx-background-color: #3498db; -fx-padding: 15 20;">
            <Button text="â† Back" onAction="#handleBack" style="-fx-background-color: transparent; -fx-text-fill: white; -fx-border-color: white; -fx-border-radius: 5; -fx-cursor: hand;"/>
            <Label text="ðŸŽ¯ Contestant Dashboard" style="-fx-text-fill: white; -fx-font-size: 22; -fx-font-weight: bold;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="userNameLabel" text="Welcome, User" style="-fx-text-fill: white; -fx-font-size: 14;"/>
            <Label fx:id="cfHandleLabel" text="CF: --" style="-fx-text-fill: #bdc3c7; -fx-font-size: 12;"/>
            <Button text="Profile" onAction="#handleProfile" style="-fx-background-color: white; -fx-text-fill: #3498db; -fx-background-radius: 5; -fx-cursor: hand;"/>
            <Button text="Logout" onAction="#handleLogout" style="-fx-background-color: transparent; -fx-text-fill: white; -fx-border-color: white; -fx-border-radius: 5; -fx-cursor: hand;"/>
        </HBox>
    </top>
    
    <!-- Main Content -->
    <center>
        <TabPane tabClosingPolicy="UNAVAILABLE" style="-fx-background-color: #ecf0f1;">
            
            <!-- Tab 1: Available Contests -->
            <Tab text="ðŸ† Available Contests">
                <VBox spacing="20" style="-fx-padding: 20;">
                    
                    <HBox alignment="CENTER_LEFT" spacing="15">
                        <Label text="Available Selection Contests" style="-fx-font-size: 18; -fx-font-weight: bold;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <TextField fx:id="searchContestField" promptText="Search contests..." prefWidth="250"/>
                        <Button text="ðŸ”„ Refresh" onAction="#handleRefreshContests" style="-fx-background-color: #3498db; -fx-text-fill: white;"/>
                    </HBox>
                    
                    <VBox style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 10;" VBox.vgrow="ALWAYS">
                        <TableView fx:id="availableContestsTable" VBox.vgrow="ALWAYS">
                            <columns>
                                <TableColumn fx:id="avContestCodeCol" text="Code" prefWidth="100"/>
                                <TableColumn fx:id="avContestNameCol" text="Contest Name" prefWidth="250"/>
                                <TableColumn fx:id="avSubContestsCol" text="Sub-Contests" prefWidth="100"/>
                                <TableColumn fx:id="avParticipantsCol" text="Participants" prefWidth="100"/>
                                <TableColumn fx:id="avStartDateCol" text="Start Date" prefWidth="120"/>
                                <TableColumn fx:id="avEndDateCol" text="End Date" prefWidth="120"/>
                                <TableColumn fx:id="avStatusCol" text="Status" prefWidth="80"/>
                                <TableColumn fx:id="avActionsCol" text="Action" prefWidth="120"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </Tab>
            
            <!-- Tab 2: My Contests -->
            <Tab text="ðŸ“‹ My Contests">
                <VBox spacing="20" style="-fx-padding: 20;">
                    
                    <HBox alignment="CENTER_LEFT" spacing="15">
                        <Label text="My Registered Contests" style="-fx-font-size: 18; -fx-font-weight: bold;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label fx:id="myContestsCountLabel" text="0 contests" style="-fx-text-fill: #7f8c8d;"/>
                    </HBox>
                    
                    <VBox style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 10;" VBox.vgrow="ALWAYS">
                        <TableView fx:id="myContestsTable" VBox.vgrow="ALWAYS">
                            <columns>
                                <TableColumn fx:id="myContestCodeCol" text="Code" prefWidth="100"/>
                                <TableColumn fx:id="myContestNameCol" text="Contest Name" prefWidth="250"/>
                                <TableColumn fx:id="mySubContestsCol" text="Sub-Contests" prefWidth="100"/>
                                <TableColumn fx:id="myRegDateCol" text="Registered On" prefWidth="120"/>
                                <TableColumn fx:id="myStatusCol" text="Status" prefWidth="80"/>
                                <TableColumn fx:id="myFinalRatingCol" text="Final Rating" prefWidth="100"/>
                                <TableColumn fx:id="myRankCol" text="Rank" prefWidth="80"/>
                                <TableColumn fx:id="myActionsCol" text="Actions" prefWidth="150"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </Tab>
            
            <!-- Tab 3: Contest Details & Standings -->
            <Tab text="ðŸ… Standings">
                <VBox spacing="20" style="-fx-padding: 20;">
                    
                    <HBox alignment="CENTER_LEFT" spacing="15">
                        <Label text="Contest Standings" style="-fx-font-size: 18; -fx-font-weight: bold;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <ComboBox fx:id="standingsContestCombo" promptText="Select Contest" prefWidth="300" onAction="#handleLoadStandings"/>
                    </HBox>
                    
                    <!-- Contest Info Card -->
                    <HBox spacing="20">
                        <VBox fx:id="contestInfoCard" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 10;" HBox.hgrow="ALWAYS">
                            <Label fx:id="selectedContestNameLabel" text="Select a contest to view standings" style="-fx-font-size: 16; -fx-font-weight: bold;"/>
                            <HBox spacing="30" style="-fx-padding: 10 0;">
                                <VBox>
                                    <Label text="Sub-Contests" style="-fx-text-fill: #7f8c8d; -fx-font-size: 11;"/>
                                    <Label fx:id="infoSubContestsLabel" text="--" style="-fx-font-size: 18; -fx-font-weight: bold;"/>
                                </VBox>
                                <VBox>
                                    <Label text="Participants" style="-fx-text-fill: #7f8c8d; -fx-font-size: 11;"/>
                                    <Label fx:id="infoParticipantsLabel" text="--" style="-fx-font-size: 18; -fx-font-weight: bold;"/>
                                </VBox>
                                <VBox>
                                    <Label text="Your Rank" style="-fx-text-fill: #7f8c8d; -fx-font-size: 11;"/>
                                    <Label fx:id="infoYourRankLabel" text="--" style="-fx-font-size: 18; -fx-font-weight: bold; -fx-text-fill: #27ae60;"/>
                                </VBox>
                                <VBox>
                                    <Label text="Your Rating" style="-fx-text-fill: #7f8c8d; -fx-font-size: 11;"/>
                                    <Label fx:id="infoYourRatingLabel" text="--" style="-fx-font-size: 18; -fx-font-weight: bold; -fx-text-fill: #3498db;"/>
                                </VBox>
                            </HBox>
                        </VBox>
                    </HBox>
                    
                    <!-- Sub-Contest Breakdown -->
                    <VBox fx:id="subContestBreakdown" visible="false" managed="false" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 10;">
                        <Label text="Sub-Contest Breakdown" style="-fx-font-size: 14; -fx-font-weight: bold;"/>
                        <TableView fx:id="subContestResultsTable" prefHeight="150">
                            <columns>
                                <TableColumn fx:id="scNameCol" text="Sub-Contest" prefWidth="250"/>
                                <TableColumn fx:id="scWeightCol" text="Weight" prefWidth="80"/>
                                <TableColumn fx:id="scRankCol" text="Rank" prefWidth="80"/>
                                <TableColumn fx:id="scPointsCol" text="Points" prefWidth="80"/>
                                <TableColumn fx:id="scRatingCol" text="Rating" prefWidth="100"/>
                                <TableColumn fx:id="scWeightedCol" text="Weighted" prefWidth="100"/>
                            </columns>
                        </TableView>
                    </VBox>
                    
                    <!-- Main Standings Table -->
                    <VBox style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 10;" VBox.vgrow="ALWAYS">
                        <Label text="Final Standings" style="-fx-font-size: 14; -fx-font-weight: bold; -fx-padding: 0 0 10 0;"/>
                        <TableView fx:id="standingsTable" VBox.vgrow="ALWAYS">
                            <columns>
                                <TableColumn fx:id="rankCol" text="Rank" prefWidth="60"/>
                                <TableColumn fx:id="usernameCol" text="Username" prefWidth="150"/>
                                <TableColumn fx:id="cfHandleCol" text="CF Handle" prefWidth="150"/>
                                <TableColumn fx:id="finalRatingCol" text="Final Rating" prefWidth="120"/>
                                <TableColumn fx:id="participatedCol" text="Participated" prefWidth="100"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </Tab>
            
            <!-- Tab 4: Profile & Settings -->
            <Tab text="âš™ï¸ Profile">
                <VBox spacing="20" style="-fx-padding: 30;" alignment="CENTER">
                    
                    <VBox spacing="15" style="-fx-background-color: white; -fx-padding: 30; -fx-background-radius: 10;" maxWidth="500" alignment="CENTER">
                        <Label text="Profile Settings" style="-fx-font-size: 20; -fx-font-weight: bold;"/>
                        
                        <GridPane hgap="15" vgap="15" alignment="CENTER">
                            <columnConstraints>
                                <ColumnConstraints minWidth="150" halignment="RIGHT"/>
                                <ColumnConstraints minWidth="250"/>
                            </columnConstraints>
                            
                            <Label text="Username:" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                            <Label fx:id="profileUsernameLabel" text="--" style="-fx-font-weight: bold;" GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                            
                            <Label text="Email:" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                            <Label fx:id="profileEmailLabel" text="--" GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                            
                            <Label text="Codeforces Handle:" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                            <HBox spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="2">
                                <TextField fx:id="cfHandleField" promptText="Enter CF handle" HBox.hgrow="ALWAYS"/>
                                <Button text="Validate" onAction="#handleValidateCFHandle" style="-fx-background-color: #3498db; -fx-text-fill: white;"/>
                            </HBox>
                            
                            <Label text="CF Rating:" GridPane.columnIndex="0" GridPane.rowIndex="3"/>
                            <Label fx:id="cfRatingLabel" text="--" GridPane.columnIndex="1" GridPane.rowIndex="3"/>
                            
                            <Label text="CF Rank:" GridPane.columnIndex="0" GridPane.rowIndex="4"/>
                            <Label fx:id="cfRankLabel" text="--" GridPane.columnIndex="1" GridPane.rowIndex="4"/>
                            
                            <Label text="Member Since:" GridPane.columnIndex="0" GridPane.rowIndex="5"/>
                            <Label fx:id="memberSinceLabel" text="--" GridPane.columnIndex="1" GridPane.rowIndex="5"/>
                        </GridPane>
                        
                        <HBox spacing="15" alignment="CENTER" style="-fx-padding: 20 0 0 0;">
                            <Button text="Update CF Handle" onAction="#handleUpdateCFHandle" style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-font-weight: bold;"/>
                            <Button text="Change Password" onAction="#handleChangePassword" style="-fx-background-color: #e74c3c; -fx-text-fill: white;"/>
                        </HBox>
                        
                        <Label fx:id="profileStatusLabel" text="" style="-fx-text-fill: #27ae60;"/>
                    </VBox>
                    
                    <!-- CF Validation Status -->
                    <VBox fx:id="cfValidationBox" visible="false" managed="false" spacing="10" style="-fx-background-color: white; -fx-padding: 20; -fx-background-radius: 10;" maxWidth="500">
                        <Label text="Codeforces Handle Validation" style="-fx-font-size: 16; -fx-font-weight: bold;"/>
                        <HBox spacing="20">
                            <VBox>
                                <Label text="Handle" style="-fx-text-fill: #7f8c8d; -fx-font-size: 11;"/>
                                <Label fx:id="valHandleLabel" text="--" style="-fx-font-weight: bold;"/>
                            </VBox>
                            <VBox>
                                <Label text="Rating" style="-fx-text-fill: #7f8c8d; -fx-font-size: 11;"/>
                                <Label fx:id="valRatingLabel" text="--"/>
                            </VBox>
                            <VBox>
                                <Label text="Rank" style="-fx-text-fill: #7f8c8d; -fx-font-size: 11;"/>
                                <Label fx:id="valRankLabel" text="--"/>
                            </VBox>
                            <VBox>
                                <Label text="Max Rating" style="-fx-text-fill: #7f8c8d; -fx-font-size: 11;"/>
                                <Label fx:id="valMaxRatingLabel" text="--"/>
                            </VBox>
                        </HBox>
                    </VBox>
                </VBox>
            </Tab>
        </TabPane>
    </center>
    
    <!-- Bottom Status Bar -->
    <bottom>
        <HBox alignment="CENTER_LEFT" spacing="20" style="-fx-background-color: #2c3e50; -fx-padding: 8 20;">
            <Label fx:id="statusLabel" text="Ready" style="-fx-text-fill: white;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="lastUpdateLabel" text="Last Update: --" style="-fx-text-fill: #95a5a6;"/>
        </HBox>
    </bottom>
</BorderPane>
